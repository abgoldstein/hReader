// Generated by CoffeeScript 1.3.3
(function() {
  var patientId, rootContext;

  rootContext = 'http://127.0.0.1:3000';

  patientId = 2;

  this.PopHealth = {
    constructor: function(measures) {
      this.measures = measures;
      return this.measures || (this.measures = {});
    },
    getAvailableMeasures: function() {
      return $.ajax({
        type: "GET",
        url: "" + rootContext + "/measures/available",
        isModified: false,
        dataType: "jsonp",
        success: function(measures) {
          return PopHealth.pollMeasures(measures);
        },
        error: function(jqXHR, textStatus, errorThrown) {
          return PopHealth.showUnreachable();
        }
      });
    },
    pollMeasures: function(measures) {
      var measure, _i, _len, _results;
      _results = [];
      for (_i = 0, _len = measures.length; _i < _len; _i++) {
        measure = measures[_i];
        _results.push(PopHealth.pollMeasure(measure));
      }
      return _results;
    },
    pollMeasure: function(measure, uuid) {
      var url;
      url = "" + rootContext + "/measures/patient_result/" + patientId + "/" + measure['id'] + "/";
      if (measure["sub_id"] != null) {
        url += "" + measure['sub_id'];
      }
      if (uuid) {
        url += "?uuid=" + uuid;
      }
      return $.ajax({
        type: "GET",
        url: url,
        dataType: "jsonp",
        success: function(data) {
          if (data['completed']) {
            return PopHealth.updateMeasure(data);
          } else {
            return PopHealth.pollMeasure(measure, data["uuid"]);
          }
        },
        error: function(data) {
          return PopHealth.showError(data);
        }
      });
    },
    updateMeasure: function(measure) {},
    showError: function(measure) {
      return alert("There was an error retrieving measure");
    },
    showResult: function(measure) {
      var title;
      title = $(measure).innerHTML;
      $("#more-info").hide();
      return $("#more-info").slideDown();
    },
    showUnreachable: function(data) {
      return alert("Service is unreachable");
    },
    filterResults: function(criteria) {
      var results;
      results = $(".category ul li." + criteria);
      results.slideToggle();
      return results.toggleClass('result-filter');
    },
    filterCategory: function(categoryHeader) {
      var measures;
      measures = $(categoryHeader).parent(".category").find("li");
      measures.slideToggle();
      return measures.toggleClass('category-filter');
    }
  };

  $(document).ready(function() {
    $(".category ul li").on("mouseup", function(event) {
      return PopHealth.showResult(event.target);
    });
    $(".category h3").on("mouseup", function(event) {
      return PopHealth.filterCategory(event.target);
    });
    $(".pophealth-result-container").on("mouseup", function(event) {
      return PopHealth.filterResults(event.target.getAttribute("data-filter-criteria"));
    });
    return PopHealth.getAvailableMeasures();
  });

}).call(this);
